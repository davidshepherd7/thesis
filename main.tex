\documentclass[11pt,a4paper,pdftex]{article}
%% use book eventually? - lets us have chapters

%% General packages
%% ============================================================
\usepackage{amsmath,amssymb,amsfonts,amsthm}   %Add maths commands, symbols and fonts
\usepackage{url}                %Support for urls

\usepackage[colorlinks=true, % colour all links black (just using
            linkcolor=black, % colorlinks=false results in boxes around
            citecolor=black, % links)
            filecolor=black,
            urlcolor=black]{hyperref}

\usepackage{xspace} % command for fixing spaces after macros


% Language
% ============================================================
% Support for UTF8 input
\usepackage[utf8]{inputenc}

%% % Handle non-ascii fonts properly, see
%% % http://tex.stackexchange.com/questions/664/why-should-i-use-usepackaget1fontenc
%% \usepackage[T1]{fontenc}
%% % Seems to break searching so I'm not using it...

% Commonly recommend, not sure what it does...
\usepackage[UKenglish]{babel}

%% Page Layout
%% ============================================================
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}

\rhead{}        %Set right header contents
\cfoot{\thepage}        %Page number in centre footer

% These 3 commands set the left header to display the current section
\renewcommand{\sectionmark}[1]{\markboth{#1}{}}
\lhead{\leftmark}
\setlength{\headheight}{15.2pt}

% Set up border widths
\usepackage[top=1in, bottom=1in, left=1.4in, right=1.2in]{geometry}

% % Title within the first page
%\usepackage{titling}   %Reduce spacing before title
%\setlength{\droptitle}{-6em}   %-6em reduces to ~normal margins

% Paragraphs use a vertical space rather than tabbing
\setlength{\parskip}{\medskipamount}
\setlength{\parindent}{0pt}
\usepackage[hang,flushmargin]{footmisc} % same for footnotes

% Adds a landscape enviroment
\usepackage{lscape}

%% Figure Tweaks
%% ============================================================
\usepackage[pdftex]{graphicx}   %Needed to include pictures

% positioning tweaks
\renewcommand{\topfraction}{0.85}
\renewcommand{\textfraction}{0.1}
\renewcommand{\floatpagefraction}{0.75}

% Italic captions
\usepackage[labelfont=it,textfont=it]{caption}


%% Equations/maths
%% ============================================================
\numberwithin{equation}{section} % Number equations by "<section>.<number>".

%\usepackage{nath}
% % Prevent line break in the middle of maths except in extreme cases (increse numbers to make line breaking even more unlikely)
% \relpenalty=3000
% \binoppenalty=5000



%% Bibliograpy Tweaks
%% ============================================================

% biblatex setup
\usepackage[backend=biber,
  citestyle=numeric,
  firstinits=true, % Only print initials of first names
  isbn=false,
  doi=false,
  %% dashed=false % never replace repeated author names by _____
]{biblatex}

% Add bibtex files
\addbibresource{websites.bib}
\addbibresource{library.bib}
\addbibresource{mendeley_library.bib}

%% % A superscript ciation command
%% \DeclareCiteCommand{\supercite}[\mkbibsuperscript]
%%   {\iffieldundef{prenote}
%%      {}
%%      {\BibliographyWarning{Ignoring prenote argument}}%
%%    \iffieldundef{postnote}
%%      {}
%%      {\BibliographyWarning{Ignoring postnote argument}}}
%%   {\usebibmacro{citeindex}%
%%    \bibopenbracket\usebibmacro{cite}\bibclosebracket}
%%   {\supercitedelim}
%%   {}

%% % Use superscript cite instead of normal ones
%% \let\cite=\supercite



%% Flow charts
%% ============================================================
\usepackage{tikz} % Package for drawing flow charts
\usetikzlibrary{shapes,arrows}

\definecolor{paleblue}{RGB}{239,242,255}
\definecolor{solidblue}{RGB}{43,0,229}

% Define a rectangle shape and an arrow
\tikzstyle{block} = [rectangle, draw, fill=paleblue, thick,
    text width=4.3cm, text centered, rounded corners, minimum height=1cm]
\tikzstyle{line} = [draw, -]


%% Define new commands
%% ============================================================

%% General Latex commands
%% ------------------------------
% New way to define commands that allows multiple subscripts
\makeatletter
\newcommand\newsubcommand[3]{\newcommand#1{#2\sc@sub{#3}}}
\def\sc@sub#1{\def\sc@thesub{#1}\@ifnextchar_{\sc@mergesubs}{_{\sc@thesub}}}
\def\sc@mergesubs_#1{_{\sc@thesub#1}}
\makeatother

%% % The LyX greyedout annotation environment
%% \usepackage{color}
%% \definecolor{note_fontcolor}{rgb}{0.80078125, 0.80078125, 0.80078125}
%% \newenvironment{lyxgreyedout}
%%   {\textcolor{note_fontcolor}\bgroup\ignorespaces}
%%   {\ignorespacesafterend\egroup}

% Latin
% ============================================================

% trailing slash is needed so that latex knows the final . is not the end
% of a sentence.

\newcommand{\ie}{\textit{i.e.}\ }
\newcommand{\cf}{\textit{c.f.}\ }
\newcommand{\eg}{\textit{e.g.}\ }
\newcommand{\etal}{\textit{et al.}\ }
\newcommand{\etc}{etc.\ }



%% General maths commands
%% ------------------------------
\newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}} % partial deriv
\newcommand{\spd}[2]{\frac{\partial^2 #1}{\partial {#2}^2}} % 2nd partial deriv
\newcommand{\ddn}[1]{\pd{#1}{\nv}} % normal derivative
\newcommand{\vd}[2]{\frac{\delta #1}{\delta #2}} % variational derivative

\newcommand{\E}[1]{\times 10^{#1}} % powers of 10
\newcommand{\st}{\,|\,} % ``such that'' operator in sets (vertical line with spacing)

\newcommand{\ip}[2]{\left(#1,\, #2 \right)} % inner product
\newcommand{\ltip}[2]{\ip{#1}{#2}_{\ltwo}} % l2 inner product


% Norm and abs: better spacing than if done manually with |
\newcommand{\abs}[1]{\lvert #1 \rvert}
\newcommand{\norm}[1]{\lVert #1 \rVert}
\newcommand{\ltnorm}[1]{\norm{#1}_{\ltwo}}


% d for the end of integrals (e.g. dx) with correct spacing and non-italic
\renewcommand{\d}{{\; \text{d}}}
% standard integrals
\newcommand{\intd}[2][\magd]{{\int_{#1} #2 \d {#1}}}
\newcommand{\intb}[1]{\intd[\boundd]{#1}}

% Some vector functions
\newcommand{\gv}{{\mathbf{g}}}
\newcommand{\fv}{{\mathbf{f}}}

% Some vectors
\newcommand{\av}{{\mathbf{a}}}
\newcommand{\bv}{{\mathbf{b}}}
\newcommand{\cv}{{\mathbf{c}}}

\newcommand{\ev}{\mathbf{\hat{e}}}
\newcommand{\nv}{\mathbf{\hat{n}}}

\newcommand{\xv}{\mathbf{x}}
\newcommand{\yv}{\mathbf{y}}

\newcommand{\unitv}[1]{{\hat{#1}}}
\newcommand{\iv}{\unitv{i}}
\newcommand{\jv}{\unitv{j}}
\newcommand{\kv}{\unitv{k}}

% 3-component vector as a list of components
\newcommand{\threevec}[3]{\begin{pmatrix} #1 \\ #2 \\ #3 \end{pmatrix} }

% Big O notation
\newcommand{\order}[1]{\text{O}(#1)}
\newcommand{\porder}[1]{\quad + \order{#1}} % with larger spacing

% Differential operators
\renewcommand{\div}{\nabla \cdot} % \div is normally division
\newcommand{\grad}{\nabla}
\newcommand{\curl}{\nabla \cross}
\newcommand{\lap}{\nabla^2}


%% Spaces, domains and geometrical labels
%% ------------------------------
% Domain labels used
\newcommand{\magd}{\Omega}
\newcommand{\boundd}{{\Gamma}}
\newcommand{\fulld}{{\real^d}}
\newcommand{\extd}{{\Omega^c}}

%Interior/exterior labels
\newcommand{\inte}{\text{int}}
\newcommand{\exte}{\text{ext}}

\newcommand{\real}{\mathbb{R}} % real numbers
\newcommand{\complex}{\mathbb{C}} % complex numbers

\newcommand{\sob}{\mathcal{H}} % Sobelov spaces
\newcommand{\ltwo}{L^2} %L2

\newcommand{\Dfs}{\mathcal{D}} % Set of functions that obey Dirichlet boundaries
\newcommand{\Neu}{{\scriptscriptstyle{\mathcal{N}}}} % Neumann


%% Magnetics
%% ------------------------------
% Define M, H, B vectors (i.e. bold)
\newcommand{\Mv}{\mathbf{M}}
\newcommand{\Hv}{\mathbf{H}}
\newcommand{\Bv}{\mathbf{B}}


% polar coords
\newcommand{\ruv}{\mathbf{\hat{r}}} % r unit vector
\newcommand{\phiv}{\mathbf{\hat{\phi}}}
\newcommand{\thetav}{\mathbf{\hat{\theta}}}
\newcommand{\rv}{\mathbf{r}} % r vector


% Define some common types of H-field.
% if changing these beware of components of H which are not defined here.
\newsubcommand{\Heff}{\mathbf{H}}{{\text{eff}}} %effective (total)
\newsubcommand{\Happ}{\mathbf{H}}{{\text{ap}}} %applied
\newsubcommand{\Hms}{\mathbf{H}}{\text{ms}} % magnetostatic/demag
\newsubcommand{\phim}{\phi}{\text{m}} % magnetostatic potential
\newsubcommand{\Hex}{\mathbf{H}}{\text{ex}} % exchange
\newsubcommand{\Hca}{\mathbf{H}}{\text{ca}} % crystalline ansiotropy
\newsubcommand{\Hthm}{\mathbf{H}}{\text{th}} % thermal

% Normalised versions of the above fields (and M)
\newcommand{\mv}{\mathbf{m}}
\newcommand{\hv}{\mathbf{h}}
\newsubcommand{\heff}{\mathbf{h}}{{\text{eff}}} %effective (total)
\newsubcommand{\happ}{\mathbf{h}}{{\text{ap}}} %applied
\newsubcommand{\hms}{\mathbf{h}}{\text{ms}} % magnetostatic/demag
\newsubcommand{\hex}{\mathbf{h}}{\text{ex}} % exchange
\newsubcommand{\hca}{\mathbf{h}}{\text{ca}} % crystalline ansiotropy
\newsubcommand{\hthm}{\mathbf{h}}{\text{th}} % thermal
\newcommand{\nH}{H_{\mathbb{n}}} % A "magnitude" of H for normalisation

% Similarly for energies
\newsubcommand{\Eapp}{E}{{\text{ap}}} %applied
\newsubcommand{\Ems}{E}{\text{ms}} % magnetostatic/demag
\newsubcommand{\Eex}{E}{\text{ex}} % exchange
\newsubcommand{\Eca}{E}{\text{ca}} % crystalline ansiotropy
\newcommand{\e}{e} % total energy
\newsubcommand{\eapp}{e}{{\text{ap}}} %applied
\newsubcommand{\ems}{e}{\text{ms}} % magnetostatic/demag
\newsubcommand{\eex}{e}{\text{ex}} % exchange
\newsubcommand{\eca}{e}{\text{ca}} % crystalline ansiotropy
\newsubcommand{\ehop}{\e}{\hop} % total due to h operator fields


\newcommand{\nE}{E_{\mathbb{n}}} % A "magnitude" of energy for normalisation
\newcommand{\nA}{\mathbb{A}} % A "magnitude" of exchange const for normalisation
\newcommand{\nK}{\mathbb{K}} % A "magnitude" of anisotropy const for normalisation

% Magnetic constants
\newcommand{\Exchc}{A}
\newcommand{\Kone}{K_1}
\newcommand{\kone}{\mathcal{K}_1}
\newcommand{\dampc}{\alpha}
\newcommand{\dampeff}{\alpha_\text{eff}}
\newcommand{\gymagc}{{\abs{\gamma_{\text{\tiny{L}}}}}}


% SI magnetic units (Kronmuller2003)
\newcommand{\Mu}{{\text{Am}^{-1}}}
\newcommand{\Hu}{{\text{Am}^{-1}}}
\newcommand{\phiu}{{\text{A}}} % magnetic potentials
\newcommand{\Bu}{{\text{T}}}
\newcommand{\gymagu}{{\text{A}(\text{ms})^{-1}}}

% Define the LLG equation (in parts then all together)
\newcommand{\dMdt}{\pd{\Mv}{t}} % define dM/dt
\newcommand{\dmdt}{\pd{\mv}{t}}
\newcommand{\MxH}{\Mv \times \Hv} % define M x H
\newcommand{\mxh}{\mv \times \hv}
\newcommand{\mxmxh}{\mv \left(\mv \times \hv \right)}
\newcommand{\MxdMdt}{\Mv \times \dMdt}
\newcommand{\mxdmdt}{\mv \times \dmdt}
\newcommand{\llg}{\dmdt = -(\mxh) + \dampc (\mxdmdt)}

%% Finite elements/numerical models
%% ------------------------------
% Define the test and shape functions
\newcommand{\tbf}{\varphi}
\newcommand{\sbf}{\psi}
\newcommand{\ts}{{\mathcal{H}^1_h(\magd)}} % my test/shape fn space
\newcommand{\sk}{{\sbf_k}}
\newcommand{\tn}{{\tbf_\ndi}}

% Indices
\newcommand{\ndi}{n} % nodal index, not sure what to have it as...
\newcommand{\eli}{e} % element index
\newcommand{\tl}{l} % time-step index

% Green's functions - general form and main parts of 2/3D Green's functions for the laplacian operator
\newcommand{\Green}[1][]{G(\xv_{#1},\yv)}
\newcommand{\Gtwod}[1][]{\ln \abs{\xv_{#1} - \yv}}
\newcommand{\Gthreed}[1][]{\frac{1}{ \abs{\xv_{#1} - \yv}}}

% Boundary matrix
\newcommand{\bm}{{\mathbf{G}}}

% subscripts used
\newcommand{\ibasis}{{i}}
\newcommand{\ibasisb}{{j}}
\newcommand{\ibasisc}{{k}}

%% Time stepping
%% ------------------------------

% time step
\newcommand{\dtn}{\dtx{n}}
\newcommand{\dtx}[1]{\Delta_{#1}}

% "value step"
% Getting bold greek requires a hack because mathbf sees it as a "symbol"
% and so doesn't change it. This uses the direct TeX solution (from google!)
\newcommand{\dyn}{\dyx{n}}
\newcommand{\dyx}[1]{\mbox{\boldmath$\delta$}_{#1}}

% Denote various time steppers
\newcommand{\AB}{\text{AB}} % Adams-Bashforth 2
\newcommand{\IMP}{\text{IMR}} % Implicit midpoint
\newcommand{\FE}{\text{FE}} % Forward Euler (like)

% Local truncation errors
\newcommand{\lte}{T_n}


% Operators
% ============================================================
\usepackage{mathrsfs}
\newcommand{\myop}[1]{\mathscr{#1}}
\newcommand{\hop}{\myop{H}}
\newcommand{\hmsop}{\myop{H}_{\text{ms}}}
\newcommand{\aop}{\myop{A}}
\newcommand{\bop}{\myop{B}}
\newcommand{\cop}{\myop{C}}
\newcommand{\lop}{\myop{L}}


% Fractions
% ============================================================

%% Nice one line fractions
\usepackage{xfrac}
\usepackage[ugly]{nicefrac}

\newcommand{\half}{\nicefrac{1}{2}}


% Some typewritter text
% ============================================================

% Make sure it's not italic or anything as well as being tt, because it
% looks different (and stupid). \xspace makes sure there is a space
% afterwards at the correct times without having to explicitly write the
% empty argument (i.e. \toltt{}). It can be suppressed by writing the empty
% argument.
\newcommand{\toltt}{{\textrm{\textup{\texttt{tol}}}\xspace}}


% Stuff needed for galerkin
% ============================================================
\newcommand{\skewop}{\text{\Large{$\Lambda$}}}
\newcommand{\skewm}[1]{\skewop\left[ #1 \right]}
\newcommand{\crossop}[2]{\skewm{ #1 } \cdot \left( #2 \right)}

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
    \node[shape=circle,draw,inner sep=1pt] (char) {#1};}}
\newcommand{\mxex}{I}
\newcommand{\mxmxex}{J}

\newsubcommand{\rex}{\mathbf{r}}{\text{ex}}
\newsubcommand{\rexh}{\mathbf{r}}{\text{ex,h}}
\newsubcommand{\rll}{\mathbf{r}}{\text{ll}}

\newcommand{\intp}[1]{\sum_\ibasisc \sk #1_\ibasisc}
\newcommand{\intpb}[1]{\left( \intp{#1} \right)}
\newsubcommand{\hs}{\hv}{\text{s}}

\newcommand{\ik}{\ibasisc}

\newcommand{\dtsdml}{J_\text{ts}}



% Notation for midpoint method stuff
% ============================================================

% t at midpoint
\newcommand{\thfx}[1]{t_{#1+\half}}
\newcommand{\thf}{\thfx{n}}

% exact y of t at midpoint
\newcommand{\yvhfx}[2]{\yv#1(\thfx{#2})}
\newcommand{\yvhf}[1][]{\yvhfx{#1}{n}}

% midpoint approximation to y
\newcommand{\yvmx}[1]{\yv_{#1+\half}}
\newcommand{\yvm}{\yvmx{n}}


% df/dy matrix
\newcommand{\dfdy}{F}
\newcommand{\dfdyhfx}[1]{\dfdy_{#1+\half}}
\newcommand{\dfdyhf}{\dfdyhfx{n}}

% error due to midpoint approx
\newcommand{\ymiderr}{a_n}

% full expressions for midpoint values
\newcommand{\mpm}{\frac{\mv_{n+1} + \mv_n}{2}}
\newcommand{\mpt}{\frac{t_n + t_{n+1}}{2}}
\newcommand{\mpdmdt}{\frac{\mv_{n+1} - \mv_n}{\dtn}}
\newcommand{\mphop}{\hop \left[ \mpm \right]}
\newcommand{\mphapp}{\happ \left(\mpt \right)}



%% Beginning of main document
%% =============================================================

% Include only some sections while working on them, remove before final
%\includeonly{first_year_progress}


% \author{David Shepherd}
% \date{30 March 2012}

\begin{document}

\input{./title.tex}

\setcounter{page}{2} % Title is page 1, so that pdf page numbers match with
% our pages numbers
\include{./listofsymbols}

\setcounter{tocdepth}{2} % Set contents to only go down to subsection level
\tableofcontents

\include{./introduction}

%% \include{./trilemma}

%% \include{./perp_recording}

\include{./continuous_micromagnetics}

\include{./modelling_basics}

\include{./finite_ele_diff}

\include{./galerkin-ll}

\include{./boundary_elements}

%\include{./quadrature/quadrature}

\include{./midpoint}
\include{./imr_micromagnetics}
%% \include{./midpoint_verification}

%  preconditioners:
% (very) basicis
% what have people done before?

%  LLB/ heat flow modelling
% very basics
% what have people done before?

\appendix
\include{llg-signs}
\include{non-dimensionalisation}
\include{analytical-solutions}
%% \include{galerkin-llg}
\include{linear_sym_op}

\begin{landscape}
  \begin{table}
    \centering
    \input{./other_models}
    \caption{Some key features of micromagnetic codes. The entry for oomph-lib (1) lists the features that are already available in the library (except mid-point method will be implemented). Codes (2-4) are currently available open source micromagnetics models, while numbers 5-6 are commercial, closed source packages.}
    \label{fig:other-models}
  \end{table}
\end{landscape}

%\bibliographystyle{amsalpha} %use codes instead of numbers
%% \bibliographystyle{amsplain}

% Make sure websites is before the Mendeley library as website entries needed to
% be manually adjusted but may be overridden if the Mendeley library is first in
% the list.
%% \bibliography{./websites,./library}

% Does what it says (using biblatex package)
\printbibliography

\end{document}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
