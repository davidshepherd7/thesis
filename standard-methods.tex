\chapter{Numerical Methods for Micromagnetics}
\label{sec:numer-meth-micr}

Here we give an overview of numerical methods that have been used in micromagnetics and their advantages/disadvantages.


%??ds brief discussion of the various parts needed

The systems of equations used in micromagnetics can only be solved analytically in relatively simple cases.\footnote{For example the Stoner-Wolfarth theory for the rotation of a single grain.\cite{Stoner1948a}}\cite{Aharoni1996} Hence a numerical solution is normally found involving the conversion of the continuous equations into a system of linear equations relating the values of $\Mv$ at a finite set of points and from past time(s) to a future time. Depending n the exact methods used this discrete system can then be solved by matrix inversion or direct substitution. The setup and solution of such systems is typically done computationally.

The conversion to a system of equations at finite set of point is known as spatial discretisation. The conversion to a finite set of times is known as time discretisation or timestepping. Various methods for the space and time discretisation are discussed in Sections~\ref{sec:spat-discr} and~\ref{sec:time-discretisation} respectively.

Another interesting area of numerical micromagnetics is the calculation of the magnetostatic field (\ie the magnetic field interactions between magnetised regions). The naive method of evaluation results in a double integral (or a sum after spatial discretisation) over all of the magnetic body. This is usually unreasonably slow so more advanced methods are needed. Such methods break down into two categories: methods based on quickly approximating the integrals and methods based on the use of a \emph{scalar potential} to convert the calculation into a form similar to the rest of the problem. These are discussed in Sections~\ref{sec:magstat-field-calc-inte} and~\ref{sec:magstat-field-calc-pote}.

Diagrams showing how the various methods are related are given for space discretisation in Figure~\ref{fig:types-spat-discl}, time discretisation in Figure~\ref{fig:types-time-disc}, and magnetostatic field calculations in Figure~\ref{fig:types-mag-stat}.

\section{Spatial Discretisation}
\label{sec:spat-discr}

\subsection{Macrospins}
\label{sec:sd-macrospins}

In a granular material (a material consisting of magnetic grains separated by a non-magnetic material%% , see Figure~\ref{fig:Layouts-for-magnetic}
) the simplest way to discretise the problem is to assume that within each grain the exchange coupling is so strong that it rotates as a single \emph{macrospin}. We assign a single value of $\Mv$ to each macrospin and proceed to calculate energy, effective field and/or magnetisation of each macrospin as required. One caveat is that the magnetostatic self field is not automatically accounted for since there is no modelling of intra-grain effects. Hence it must be calculated and added separately to the magnetostatic interactions between grains. When applied like this the magnetostatic self field is often called the \emph{shape anisotropy} since it is dependant on the shape of the grain and acts very similarly to the magnetocrystalline anisotropy. The same approach may be used with any system in which there are a number of ``small'',\footnote{All dimensions of the bodies must be much smaller than the exchange length so that all magnetisation within the body is approximately parallel.} separate magnetic bodies with approximately uniform magnetisation in the body.

The obvious downside of a macrospin approach is that it only applies to fairly specific geometrical cases, although the case of a granular media has been of much interest for magnetic data storage. Additionally, if there are non-uniformities in magnetisation within the regions where it has been assumed constant the model may be inaccurate. However it is often simpler to construct a macrospin model than to use the methods described in Sections~\ref{sec:sd-finite-diff-meth} and~\ref{sec:sd-finite-elem-meth}. Also the assumption that each grain has uniform magnetisation will reduce the number of calculations needed.

This approach was applied by, for example, J. Zhu and H. Bertram to study magnetisation dynamics in thin film granular media.\cite{Zhu1988}

\begin{figure}[h]
  \centering
  \begin{tikzpicture}[level 1/.style={sibling distance=5.2cm},level 2/.style={sibling distance=5cm}]
    \node[block] {\textbf{Spatial Discretisation}}
    child {node[block] {Finite Difference}}
    child {node[block] {Macrospins}}
    child {node[block] {Finite Element}};
  \end{tikzpicture}
  \caption{Spatial discretisation schemes used in micromagnetic models.}
  \label{fig:types-spat-discl}
\end{figure}


\subsection{Finite Difference Methods}
\label{sec:sd-finite-diff-meth}

Another method of spatial discretisation is the finite difference method: a single magnetisation vector is assigned to each point on (or ``cell'' in) a simple square/cubic grid which covers the system being modelled. The method is described in more detail in Section~\ref{sec:intr-finite-ele-diff}.

The finite difference method works well for very simple geometries when the grid can be lined up with all geometric features. For example when we are interested in comparing how different initial states evolve over time in a non-granular cuboid shaped piece of material a finite difference method will be sufficient (\eg in the $\mu$mag standard problems\cite{mumag-website}). However for arbitrarily shaped grains, bit patterned media or any other more complex geometric system other methods are better suited.

NIST's \texttt{OOMMF} model, one of the oldest micromagnetic models still in use, uses the finite difference method\cite{oommf-website}.

\subsection{Finite Element Methods}
\label{sec:sd-finite-elem-meth}

A more complex method of spatial discretisation is the finite element method. Here the magnetic body is divided up into a finite number of polygonal \emph{elements} which can vary in size and shape. The points where these elements meet, known as the \emph{nodes}, are each assigned a magnetisation vector. Values at any other point in the domain can be calculated by interpolation between the nodes. More details of the method are given in Section~\ref{sec:intr-finite-ele-diff}.

The main advantage of the finite element method is that it can accurately approximate any geometrical feature by an appropriate arrangement of the polygonal elements.

The accuracy of the approximation will often depend on the size of the elements used and this can be varied arbitrarily as needed to give better accuracy in harder to model regions. The choice of element size can be done automatically using \emph{adaptive mesh refinement}: after each calculation an \emph{a posteriori} error estimate is calculated. If the error is determined to be too high anywhere the mesh is refined near that region and the calculation is repeated. Hence, given the desired error and a way of estimating the error, an appropriate mesh is automatically generated.\cite{Schrefl1999}

A downside is that the underlying maths can be more complex than that of the finite difference or macrospin models, hence increasing the time required to develop the model. Also the set up time can be greater because of the additional ``bookkeeping'' required.

Finite element methods are used in the \texttt{magpar}\cite{Scholz2003}, \texttt{nmag}\cite{Fischbacher2007} and \texttt{FEMME} micromagnetics models\cite{suessco-website}.

\section{Magnetostatic Field Calculations by Integral Methods}
\label{sec:magstat-field-calc-inte}

\begin{figure}[h]
  \centering
  \begin{tikzpicture}[level 1/.style={sibling distance=5.4cm},
    level 2/.style={sibling distance=3.6cm}]

    \node[block] {\textbf{Magnetostatic Calculations}}
    child {node[block,text width=6cm] {Scalar Potential Formulation (with some spatial discretisation)}
      child{node[block,text width=4cm,xshift=-1cm] {Asymptotic Boundary Conditions}}
      child{node[block,text width=4.3cm] {Hybrid Finite/Boundary Element Method}}
    }
    child {node[block,yshift=-2.7cm] {Integral Formulation}
      child{node[block,text width=3.2cm] {Full Calculation}}
      child{node[block,text width=3.2cm] {Fast Fourier Transform}}
      child{node[block,text width=3.2cm] {Fast\\ Multipole\\ Method}}
    };
    \end{tikzpicture}
  \caption{Methods of magnetostatic field calculation that have been used in micromagnetic models.}
  \label{fig:types-mag-stat}
\end{figure}

The integral form of the magnetostatic field at a point $\xv \in \real^d$ due to the magnetic body $\magd$ with boundary $\boundd$ can be given in terms of magnetisation $\Mv$ by an integral over all volume and surface ``magnetic charges'' ($\nabla \cdot \Mv(\xv)$ and $\Mv(\xv) \cdot \nv(\xv)$ respectively) as
\begin{align}
  \Hms(\xv) &= \frac{1}{4 \pi} \Big[ - \int_\magd \frac{\big( \nabla' \cdot \Mv(\xv') \big)(\xv - \xv')}{\abs{ \xv -\xv'}^3} \d^3 \xv'
  + \int_\boundd \frac{ \big( \Mv(\xv') \cdot \nv(\xv') \big) (\xv - \xv')}{\abs{\xv - \xv'}^3} \d^2 \xv' \Big],
  \label{eq:Hmsint}
\end{align}
where $\nabla'$ denotes the grad operator with respect to the $\xv'$ coordinate. For completeness we note that single magnetic charges (magnetic monopoles) have not been observed in nature. However they are a very useful mathematical tool for calculations of magnetic fields.

% Alternatively it can be given in terms of a sum over the dipole fields of magnetic moments (\ie discretised magnetisation) as
% \begin{equation}
%   \label{eq:9}
%   \Hms(\xv) = \frac{1}{4\pi} \sum_i \frac{1}{|\xv - \xv_i|^3} \Big[ \mu_i(\xv_i) - 3(\mu_i(\xv_i) \cdot \ruv_i ) \cdot \ruv_i \Big],
% \end{equation}
% where $\ruv_i$ is the unit vector pointing from $\xv_i$ to $\xv$.

After the application of a discretisation scheme the integrals in equation~\eqref{eq:Hmsint} become a sum over all nodes. The naive way to calculate the magnetostatic fields would then be to work through the list of nodes calculating the field at each of them. Then for each node a contribution from all other nodes needs to be calculated. Hence this results in an algorithm complexity that scales as $\order{N^2}$ (where $N$ is the number of points used in the space discretisation) which is usually unacceptably slow.

\subsection{Fast Fourier Transform Methods}

If the individual magnetic charges are on a regular lattice (or approximated by a regular lattice) and the boundary conditions are periodic, then the redundancy can be exploited to speed up the magnetostatic field calculations. The calculation of $\Hms$ in equation~\eqref{eq:Hmsint} can be thought of as applying a convolution operator $D$ (\ie $\Hms = D \big[\Mv\big]$). The matrix corresponding to this operator  is only dependant on geometry, hence it can be precomputed, Fourier transformed and stored for use in the main simulation. Then all that is needed to calculate the magnetostatic field is to apply a Fourier transform to $\Mv$, compute the convolution and transform the result back into the time domain by applying the inverse Fourier transform. Because of the regularity, applying the convolution in the frequency domain is very fast and hence the complexity of the calculation is limited by the complexity of a fast Fourier transform, which is $\order{N \log(N)}$.\cite{Jones1997}

The downside of this method is that points to be calculated must be on a regular lattice, similar to the finite difference method. Hence, it is most suited for use in combination with models using a finite difference spatial discretisation. Alternatively it may be used in less regular macrospin models by approximating the the macrospins as being on a regular lattice.\cite{Jones1997}

A fast Fourier transform method is used to calculate the magnetostatic field in \texttt{OOMMF}.\cite{oommf-website}

\subsection{Fast Multipole Method}
\label{sec:fast-mult-meth}

An alternative method of calculation of the magnetostatic field is the multipole method. It takes advantage of the fact that distant magnetic charge has a much smaller effect on the total field at a point than nearby magnetic charge.

For the field calculation at a specific point, $\xv$, the full calculation is only performed for nearby magnetic charges. Groups of more distant charges are approximated (lumped) as a single multipole placed at the centre of the group. As the charges become more distant they contribute much less to the field due to the $\frac{1}{(\xv - \xv')^2}$ scaling in equation~\eqref{eq:Hmsint}. Hence for distant points the multipole approximation can become less accurate, and so faster to calculate, while still retaining the required overall level of accuracy.

The trick for quickly calculating fields at a large number of points is to pre-calculate the multipole approximations for a range of accuracies over all space. Then the calculation of a field at a single point only requires the full calculation of effects from a few nearby points and from the appropriate multipoles.\cite{Beatson}

One advantage of this method over the fast Fourier transform is that it allows for arbitrary geometries. Also the complexity of the method is $\order{N}$, where $N$ is the number of magnetic charges (equivalent to the number of nodes/cells/macrospins after spatial discretisation).\cite{Chang2011}

The fast multipole method is used, with massive parallelisation for GPUs, to quickly calculate magnetostatic fields in FastMag.\cite{Chang2011} %??ds milan: how is load balencing performed?

\section{Magnetostatic Field Calculation by a Scalar Potential}
\label{sec:magstat-field-calc-pote}

When the magnetic field is being produced only by magnets and not currents (\ie the magnetic field is irrotational) it is possible to express the field as a function of a scalar potential, $\phim$.\cite{Coey2010} Let $\magd$ be the magnetic body, $\boundd$ it's boundary and $\nv$ the outward unit normal on the boundary. Then we have
\begin{gather}
  \Hms = - \nabla \phim,  \label{eq:Hms} \\
  \lap \phim = \nabla \cdot \Mv \quad \xv \in \fulld, \label{eq:nnphim}
\end{gather}
With the following boundary conditions
\begin{gather}
  \phim^\inte - \phim^\exte = 0 \quad \xv \in \boundd, \label{eq:cont-phi-bound} \\
  \pd{\phim^\inte}{\nv} - \pd{\phim^\exte}{\nv} = \Mv \cdot \nv \quad \xv \in \boundd,
  \label{eq:nndphidn-bound} \\
  \phim \rightarrow 0 \text{ as } \abs{\xv} \rightarrow \infty, \label{eq:phi-inf}
\end{gather}
where $\phim^\inte$/$\phim^\exte$ are the values of $\phim$ just inside/outside the domain, $\magd$.

This gives a formulation which can be solved using the finite element or finite difference discretisation methods. However, the zero boundary condition on $\phim$ at infinity, \eqref{eq:phi-inf}, is problematic. We obviously can not discretise an infinite domain to apply this condition since that would involve either infinite discrete elements or an infinitely sized element. Hence other techniques must be used.

The speed of the internal field calculation is given by the discretisation method, however applying the boundary conditions can require additional processing time.

% A third possibility is to define a vector potential $\vec{A}$ such that...

\subsection{Asymptotic Boundary Conditions}
\label{sec:asymptot-bcs}

One way to avoid an infinite domain is to truncate the external region at some finite distance from the magnetic domain. However the relationship between truncation distance and accuracy is problem dependant (since the size of the external field at any point depends on the problem geometry) and does not lead to good accuracy even for large truncation distances.

A more sophisticated method is to use asymptotic boundary conditions.\cite{Yang1997} The idea here is to use a truncated external region to calculate the boundary conditions on the magnetic domain that correspond to equation~\eqref{eq:phi-inf} being applied at infinity. Additionally the fact that any solution to the Poisson equation~\eqref{eq:nnphim} can be represented as an infinite series of harmonic functions is used to improve the accuracy. However the accuracy of this approach is still low compared to the hybrid method, even for large truncation distances.\cite{Bottauscio2008}

This method of applying the boundary conditions was used by Yang in GDM\cite{Yang1997} (general purpose dynamical micromagnetic code), but the code does not seem to be available any more.

\subsection{The Hybrid Boundary/Finite Element Method}
\label{sec:bound-elem-meth}

The idea of the hybrid method is to replace the external domain by a dipole layer placed on the surface of the magnetic domain which mimics the effect of the infinite external domain. This removes the need to truncate or discretise the infinite external domain. The full details of the method applied to magnetostatic calculations is discussed in Section~\ref{sec:hybr-finit-elem}.

A comparison by Bottauscio\cite{Bottauscio2008} found that using the hybrid method was more accurate than applying asymptotic boundary conditions for a calculation of the time evolution of the magnetisation of a sphere with zero exchange coupling. Even with a truncation distance of four times the size of the magnetic sphere (the total domain was $4^d$ times larger then the sphere) the accuracy when using asymptotic boundary conditions was worse and did not improve between truncation distances of three and four times the magnetic sphere radius. Even when exchange coupling was added (giving an easier test) the truncation method was worse than the hybrid element method.

One downside is an increase in the difficulty of creating the model since some parts of the boundary element method are mathematically different to the finite element method. For example singular integrals occur in the boundary element method and more advanced integration methods are needed. Also the hybrid method requires an additional dense matrix-vector multiplication for the calculation of boundary conditions.

The speed (and memory usage) of calculation of the boundary values in the method is limited by the dense matrix multiplication which is $\order{N_b^2}$, where $N_b$ is the number of boundary nodes. The use of hierarchical matrix techniques can reduce this to $\order{N_b \log(N_b)}$.\cite{Knittel2009} Hence the speed of the hybrid method depends on the geometry. For example in 3D structures which are roughly spherical $N_b = \order{N^{2/3}}$ which gives optimal computation speed\footnote{With hierarchical matrix techniques the speed is $\order{N^{2/3}\log(N^{2/3})}$ but $\log(x) << x^{1/2}$ for large $x$, hence $\order{N^{2/3}\log(N^{2/3})} << \order{N}$, \ie optimal computation speed scaling.} but for extremely flat structures it can be as bad as $N_b = \order{N}$.

The hybrid method was first applied to the computation of magnetostatic fields by Fredkin and Koehler.\cite{Fredkin1990}


\section{Time Discretisation}
\label{sec:time-discretisation}

After applying a spatial discretisation,we obtain a semi-discrete version of  equation~\eqref{eq:LLG}: it gives a continuous value in time of $\dMdt$ at fixed discrete points in space. To make it fully discrete, so that we can numerically solve for the time evolution of $\Mv$, we need to apply a time discretisation scheme. This section only relates to dynamic micromagnetics since energy based methods do not include time dependence.

The time discretisation methods discussed here all bear a strong similarity to the finite difference method discussed in Section~\ref{sec:finite-diff-appr}, except that the independent variable is time instead of space.

To explain the different time discretisation schemes we use a simple ordinary differential equation (an initial value problem)
\begin{align}
  \frac{dy}{dt} &= f(t,y(t)), \quad t \in [0,T],  \notag \\
  y(0) &= y_0.
  \label{eq:45}
\end{align}
where $f(t,y)$ is a known function and $T$ is the end time. The idea is to use the known values of $y(t)$ at the current/previous times along with the derivative to approximate the value $y(t+h)$  after stepping forwards in time by $h$.

Some key attributes of a time discretisation scheme are:\cite{Atkinson2009}
\begin{itemize}

\item \textbf{Stability} -- A scheme is stable if the approximated solution stays close to the exact solution, even after a large number of time-steps. A scheme is called conditionally stable if it is stable only for time-steps smaller than some maximum time-step or unconditionally stable if it is stable even for very large time-steps (although for very large time-steps the accuracy may be compromised).

\item \textbf{Convergence speed} -- An estimate of how rapidly the local truncation error decreases as the time-step, $h$, is reduced.

\item \textbf{Ability to deal with stiffness} -- Some ODEs have terms which vary on very different time scales, this is referred to as stiffness. Stiff ODEs causes some solvers to require extremely small time-steps in order to remain stable. The Landau--Lifshitz--Gilbert equation is sometimes stiff because the precession and damping terms usually operate on very different timescales but are both important for determination of the dynamics.\cite{Fidler2000}

\item \textbf{Preservation of geometrical properties} -- Some differential equations have properties which should ideally be conserved in the discretised system. For example $\abs{\Mv}$ should remain constant over time in the Landau--Lifshitz--Gilbert equation but this property is often lost after discretisation.\cite{DAquino2005}

\item \textbf{Self-starting} -- A scheme is self starting if it only requires a single initial value. This is desirable because methods of estimating additional initial values may introduce errors. However more advanced schemes often require values at multiple times and so need multiple initial values.
\end{itemize}

\begin{figure}[h]
  \centering
  \resizebox{\textwidth}{!}{
    \begin{tikzpicture}[level 1/.style={sibling distance=5cm},level 2/.style={sibling distance=4.9cm},level 3/.style={sibling distance=4cm}]
      \node[block] {\textbf{Time Discretisation}}
      child{node[block] {Explicit}
        child{node[block] {RK4}}
        child{node[block] {Adams-Bashford etc.}}
      }
      child{node[block,yshift=-3.3cm] {Implicit}
        child{node[block] {BDF[N]}}
        child{node[block] (midpm) {Midpoint Method}}
      }
      child{node[block] (geom) {Geometric}
        child{node[block,xshift=1.2cm,yshift=-1.5cm] {Caley Transform (applied to a discretisation method)}}
      };
      \draw[line] (geom) -- (midpm);
    \end{tikzpicture}
  }
  \caption{Some time discretisation methods  used in micromagnetics.}
  \label{fig:types-time-disc}
\end{figure}

\subsection{Explicit Schemes}
\label{sec:explicit-schemes}

Explicit time discretisation schemes give the value at some future time in terms of the value at the present time and/or previous times. The simplest such scheme is the (forward) Euler method
\begin{equation}
  \label{eq:44}
  y(t_{n+1}) = y(t_n) + h f(t_n,y(t_n)),
\end{equation}
where $h$ is the time-step. Clearly, given $f(t,y)$ and an initial value for $y(t_0)$ we can solve for $y(t_n)$ for any $n$. However the stability and convergence behaviour of this simple scheme is less than impressive. Typically more advanced explicit schemes are used which give increased stability.\cite{Atkinson2009} Also the so called ``CFL condition'' (Courant-Freidrich-Lewy condition) can force the use of lower time-steps in explicit solvers if a finite element/difference spatial discretisation with small elements/cells is used.

Micromagnetics solvers for non-stiff systems commonly use the RK4 (fourth order Runge-Katta) method.\cite{Suess2002}


\subsection{Implicit Schemes}
\label{sec:implicit-schemes}

Implicit time discretisation schemes allow much longer time-steps to be used without loss of stability. However an implicit scheme gives the value at the next time-step in terms of current/previous times and in terms of the \emph{value at the next time-step}. Hence at each step a (linear or non-linear) system of equations must be solved, however the increase in maximum time-step size offsets this increase in calculation time per step in many cases.

The backwards differences schemes are a simple and commonly used example. The first order BDF formula is
\begin{equation}
  \label{eq:48}
  y(t_{n+1}) = y(t_n) + hf(t_{n+1}, y(t_{n+1})).
\end{equation}

Because a system of equations must be solved at each step a \emph{preconditioner} may be needed to ensure the system can be solved in optimal time (\ie $\order{N}$). Magnetostatic field calculation by the hybrid method can cause difficulties in the solution of the system of equations because it adds a dense sub-block to the otherwise sparse system.

Micromagnetics models commonly use BDF schemes of various order\cite{Suess2002} for the modelling of stiff systems. The midpoint method is another possible choice.\cite{DAquino2005}

Other micromagnetic models use a combination of implicit and explicit schemes: everything except for the magnetostatic field is discretised as normal using an implicit scheme, the magnetostatic field is updated (using an explicit calculation) after each time step. This method gains a larger time-step from the implicit method but the system of equations to be solved remains sparse. However when using this method the determination of the time-step must be done specially (\ie not using normal adaptivity) since the system of equations contains no information on the magnetostatic field.\cite{Schrefl1997}

\subsection{Adaptivity}
\label{sec:adaptivity}

Adaptive time discretisation methods vary the time-step in response to an estimate of the local truncation error. This is especially computationally efficient when the magnitude of the time derivative varies widely over time, for example if the magnetisation direction changes slowly until some unknown time when it rapidly switches.

\subsection{The Non-Convex Constraint}
\label{sec:ensuring-constant-mv}

Note that in equations~\eqref{eq:LL}, \eqref{eq:Gilbert} and \eqref{eq:LLG} the direction of $\dMdt$ is always perpendicular to the current value of $\Mv$ (since all terms contain cross products with $\Mv$). Hence we have an implicit condition: $\abs{\Mv} = M_s$. However in the discretised approximation this is often lost and must be enforced separately. This condition is often called a  \emph{non-convex constraint}\footnote{Intuitively a convex set is one such that given two members of the set all points on a straight line between them are also members of the set. With the condition $\abs{\Mv}=M_s$ the set of possible values of $\Mv$ is the surface of a sphere with radius $M_s$ which is not a convex set, hence the name.}. This can pose difficulties in the numerical solution of the Landau--Lifshitz--Gilbert equations because the approximations used do not necessarily respect the constraint. Hence the solution can end up with $|\Mv| \neq M_s$ which is un-physical (for constant temperature models).

A simple method of dealing with the constraint is to re-normalise $\Mv$ after some number of time-steps or when the error in $|\Mv|$ exceeds some tolerance.\cite{Fidler2000} However this approach fundamentally changes the system of equations being solved.\cite{Lewis2003}

If we have a system with only a single (macro)spin (\ie a single value of $\Mv$ represents the magnetisation of the entire system) it is easy to avoid this problem by using a spherical polar coordinate system $(r,\theta,\phi)$. Equation~\eqref{eq:LLG} can be expressed in terms of only the angles $(\theta,\phi)$ representing the direction of $\Mv$ and the non-convex constraint is automatically enforced since
\begin{equation}
  \label{eq:40}
  \pd{\abs{\Mv}}{t} = \pd{r}{t} \equiv 0.
\end{equation}
However to extend this to systems where $\Mv$ varies with space we have to use a separate spherical polar coordinate system at each point where $\dMdt$ is calculated. Also a Cartesian global coordinate system is still needed to calculate the interactions between the discretised points (\ie magnetostatics, exchange coupling). Hence we have to convert back and forth between coordinate systems during the simulation.\cite{Scholz2003} Finally problems can occur with this approach as the polar angle, $\theta$, approaches zero because $\pd{\Mv}{t} \propto \frac{1}{\sin(\theta)}$.\cite{Fukushima2005}

% Some people have used special test functions to keep $\abs{\Mv}$ fixed, don't understand that method yet though

``Geometrical'' integration schemes aim to solve this problem by constructing a time discretisation scheme that naturally preserves the value of $|M_s|$. An example of such a scheme is the midpoint method as used by d'Aquino. The midpoint method also has other desirable properties -- it conserves energy when the damping term is zero and it ensures that the energy is a decreasing function of time when the damping is non-zero.\cite{DAquino2005} Alternatively geometrical integration methods based on Cayley transforms can be used.\cite{Lewis2003}\cite{Bottauscio2011}
% ??ds however the proofs do not work for a weak formulation...


% \subsection{Preconditioning}

% \begin{itemize}
% \item If implicit time-stepping is used solution of the linear systems created at each time-step can be troublesome.
% \item We can speed this up using a preconditioner.
% \item Some work has been done on preconditioning by Suess et. al. \cite{Suess2002}.
% \item Also Banas et. al.\cite{Banas2008} \cite{Banas2010} used a multigrid preconditioner for the Maxwell-LLG equation( magnetostatic field is computed via Maxwell's equations, exchange field is also accounted for, crystalline anisotropy is not). The use of Maxwell's equations introduces complications because of the curls.
% \end{itemize}

\subsection{Specific micromagnetics time discretisation schemes}

??ds write something about the work summarised in Cimrak's review.

\section{Conclusions}
\label{sec:model-conclusions}

A dynamic modelling method will be used because the ability to model time dependant processes is essential.

For the spatial discretisation a macrospin model is not considered because its application is limited to cases with well separated grains and because it is not able to model effects inside a grain. Therefore a finite element spatial discretisation will be used because the ability to treat arbitrary geometries is extremely desirable (for example in the modelling of bit patterned media). Additionally \texttt{oomph-lib}\cite{oomph-lib-website} (a multi-physics open source finite element modelling library) gives an excellent framework in which to construct a new finite element micromagnetic model. This choice will also allow easy extension to the modelling of heat assisted magnetic recording using a finite element discretisation of the heat equation to model heat flow.

The magnetostatic field will be evaluated from a scalar potential by the hybrid finite/boundary element method. A finite element method will be used because it can be easily integrated into the overall model. The hybrid method will be used to apply boundary conditions because the accuracy loss involved in efficiently approximating the external region by asymptotic boundary conditions is large and problem dependant.

The time discretisation scheme used will be the mid-point method because of it's preservation of magnetisation vector length and ability to deal with stiffness. The use of preconditioners to speed up to the solution of the non-linear system created at each time-step will be investigated.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
