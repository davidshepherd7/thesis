
\chapter{Galerkin's Method for the Landau-Lifshitz Equation}
\label{ll-sec:galerk-meth-ll}

Similarly to section \autoref{sec:llg-initial-equations}.

Final equations to be solved are... ??ds copy from appendix

\section{Landau-Lifshitz-Gilbert Equation Residuals}


For the Landau-Lifshitz equation~\eqref{eq:ndll} we have a vector of three residuals.
\begin{equation}
  \begin{aligned}
    \rll = \int_\magd \tbf \dmdt &+ \tbf \mv \times \hat{\hv}
    + \dampc \tbf \mv \times \left( \mv \times \hat{\hv} \right) \\
    &+  \tbf \mv \times \lap \mv
    + \dampc \tbf \mv \times \left(\mv \times \lap \mv\right) \d\magd,
    \label{ll-res:contllg}
  \end{aligned}
\end{equation}
where
\begin{equation}
  \hat{\hv} = \happ - \nabla \phi + \kone \hca = \hv - \lap \mv
\end{equation}

We temporarily sidestep the details of time discretisation by assuming $\dmdt$ to be just another function of $\xv$ that we can solve for.


Similarly to the situation with $\phim$ we require second order space derivatives on $\mv$, but only within the exchange field terms
\begin{equation}
  \rex = \underbrace{\intd{\tbf \mv \times \lap \mv}}_{\mxex}
  + \dampc \underbrace{\intd{\tbf \mv \times \mv \times \lap \mv}}_{\mxmxex}
  \label{ll-eqn:exresterms}
\end{equation}
First we reduce the derivative order in the simpler exchange term, $\mxex$:
\begin{equation}
  \mxex =
  \intd{\tbf \mv \times \lap \mv} =
  \intd{\tbf \threevec{m_2 \lap m_3 - m_3 \lap m_2 }
      {m_1 \lap m_3 - m_3 \lap m_1 }
      {m_1 \lap m_2 - m_2 \lap m_1 }}
  \notag
\end{equation}
Considering the first term of a single component of this we can use the same techniques as in \autoref{sec:magn-field-resid} to give
\begin{align}
  \intd{(\tbf m_i) \lap m_j}
  &= \int_\boundd (\tbf m_i) \ddn{m_j} \d\boundd
  - \intd{\nabla(\tbf m_i) \cdot \nabla m_j}, \notag \\
  &= 0 - \intd{\tbf \nabla m_i \cdot \nabla m_j}
  -  \intd{m_i \nabla \tbf \cdot \nabla m_j}, \notag
\end{align}
where we have substituted in equation~\eqref{eqn:mbc} (the boundary condition on $\mv$).
So the entire first component is:
\begin{equation}
  \begin{aligned}
    \intd{\tbf (m_i \lap m_j - m_j \lap m_i)}
    &= - \int_\magd \tbf \nabla m_i \cdot \nabla m_j
    +  m_i \nabla \tbf \cdot \nabla m_j \\
    & \qquad - \tbf \nabla m_j \cdot \nabla m_i
    -  m_j \nabla \tbf \cdot \nabla m_i \d\magd, \\
    &= -\intd{m_i \nabla \tbf \cdot \nabla m_j - m_j \nabla m_i  \cdot \nabla \tbf},
  \end{aligned}
\end{equation}
which is just a cross product.
So we have
\begin{equation}
  \intd{\tbf \mv \times \lap \mv} =
  -\intd{\mv \times \threevec{\nabla m_1 \cdot \nabla \tbf}{\nabla m_2 \cdot \nabla \tbf}{\nabla m_3 \cdot \nabla \tbf}}.
\end{equation}
In a slight abuse of notation we write
\begin{equation}
  \threevec{\nabla m_1 \cdot \nabla \tbf}{\nabla m_2 \cdot \nabla \tbf}{\nabla m_3 \cdot \nabla \tbf} = \nabla \mv \cdot \nabla \tbf,
  \label{ll-eqn:gradvecm}
\end{equation}
(in a similar way to how we write the vector of Laplacians of $m_i$ as $\lap \mv$.

Next the second term of equation~\eqref{ll-eqn:exresterms}
\begin{equation}
  \mxmxex = \intd{\tbf \mv \times \left( \mv \times \lap \mv \right)}, \notag
\end{equation}
which, unfortunately, does not have such neat cancellations.
First note that we can use the identity
\begin{equation}
  \av \times ( \bv \times \cv ) = \bv ( \av \cdot \cv) - \cv ( \av \cdot \bv),
  \label{ll-eqn:double-cross-id}
\end{equation}
and $\mv \cdot \mv = \abs{\mv} = 1$ to slightly reduce the complexity of $\mxmxex$ to
\begin{equation}
  \mxmxex = \underbrace{\intd{\tbf \mv (\mv \cdot \lap \mv)}}_{\mxmxex_1} \;\;
  \underbrace{- \intd{\tbf \lap \mv}}_{\mxmxex_2}.
\end{equation}
Term $\mxmxex_2$ can again be dealt with by the same tricks as in \autoref{sec:magn-field-resid}:
\begin{equation}
  \left[ \mxmxex_2 \right]_i = -0 + \intd{\nabla \tbf \cdot \nabla m_i},
\end{equation}
or using the notation given in equation~\eqref{ll-eqn:gradvecm}
\begin{equation}
  \mxmxex_2 = \int_\magd \nabla \mv \cdot \nabla \tbf  \d\magd.
\end{equation}

The $i$-th component of term $\mxmxex_1$ is
\begin{align}
  \left[\mxmxex_1\right]_i &= \sum_j \int_\magd (\tbf m_i  m_j) \lap m_j \d\magd, \notag \\
  &= \sum_j \int_\boundd \tbf  m_i  m_j \ddn{m_j} \d\boundd
  - \int_\magd  \nabla(\tbf m_i  m_j) \cdot \nabla m_j  \d\magd, \notag \\
  &= \sum_j 0 - \int_\magd m_j \nabla(\tbf m_i) \cdot \nabla m_j
  + \tbf m_i (\nabla m_j)^2 \d\magd, \notag \\
  &= - \sum_j \int_\magd m_j \nabla(\tbf m_i) \cdot \nabla m_j
  + \tbf m_i (\nabla m_j)^2 \d\magd.
\end{align}

So finally we have the exchange contribution to the Landau-Lifshitz-Gilbert equation residual with no derivatives higher than first order:
\begin{align}
  [\rex]_i &= \int_\magd \tbf\left(  \epsilon_{ilp} m_l\nabla m_p \cdot \nabla \tbf \right)
  + \dampc \left(\nabla \tbf \cdot \nabla m_i \right) \notag\\
  &- \dampc \sum_j \left[ m_j
    \left(\nabla(\tbf m_i) \cdot \nabla m_j \right)
    + \tbf m_i (\nabla m_j)^2 \right] \d\magd.
\end{align}


\section{Spatial Discretisation}
\label{ll-sec:spat-discr-resi}

The next step is to discretise the residuals in space. As in \autoref{Derivation-of-weighted-residuals} and \ref{sub:Actual-Finite-Elements} we replace continuous variables and functions by a basis representation using a finite space of shape functions. We also replace the infinite spaces of test functions used so far by finite dimensional approximations.

We choose the solution space to be the same as the test function space (except for boundary conditions), this choice makes our method a Galerkin method. We also choose the shape/test functions to be the same for all residuals/unknowns. So the infinite dimensional space used for all shape and test functions is $\sob^1(\magd)$ with appropriate boundary conditions.

We then replace the space $\sob^1(\magd)$ by the $N$-dimensional approximation $\ts \subset \sob^1(\magd)$. In this approximation the unknowns $\mv$, $\hex$ and $\phim$ can be represented anywhere in the domain as a sum over the nodal values multiplied by the shape function, $\sk \in \ts$, for that node:
\begin{gather} % \sk = shapefn_k
  \mv = \sum_{k = 0}^{N} \sk \, \mv_k, \quad
  \phim = \sum_{k = 0}^{N} \sk \, \phim_{,k}.
  \label{ll-eq:unknowns-basis}
\end{gather}
Similarly the test functions can be approximated by a sum over the test basis functions, $\tn \in \ts$, as
\begin{equation}
  \label{ll-eq:47}
  \tbf = \sum_{\ndi = 0}^{N} \tn \, a_\ndi.
\end{equation}
Note that in our method $\sbf_k \equiv \tbf_k$, but we continue to write the two functions differently for generality. Also the basis functions for the space of test functions are often simply refered to as the test functions since they are used equivalently.

So substituting the basis representations, \eqref{ll-eq:unknowns-basis} and \eqref{ll-eq:47} into the residuals we obtain a spatially discretised version of the problem.
%% \begin{gather}
%%   \label{ll-res:tintro}
%%   \text{Given $\happ(\xv,t)$ and $\hca(\xv,t)$, $\forall k$, $\forall \ndi$ find} \notag \\
%%   \phim_{,k} \in \ts \cap \Dfs, \quad
%%   \mv_{k} \in \ts \text{ and }
%%   \pd{\mv_k(t)}{t} \in \ts \notag
%% \end{gather}
%% such that
%% \begin{align}
%%   r_{\phim, \ndi} =
%%   & - \int_{\magd} \sum_k (\nabla \tn \cdot \nabla \sk) \phim_{,k} \d \magd \notag
%%   - \int_{\magd} (\nabla \cdot (\sum_k \mv_k \sk) ) \tn \d \magd \\
%%   & + \int_{\boundd_{\Neu}} \tn g_\Neu \d \boundd = 0,
%%   \label{ll-res:tphi}
%% \end{align}
%% and
%% \begin{align}
%%   \rll &= \int_\magd \tbf \intp{\dmdt} + \left(\intp{\mv} \times \hs \right)
%%   \notag\\
%%   &+ \left(\intp{\mv} \times \left(\intp{\mv} \times \hs \right) \right) \d\magd
%%   \notag\\
%%   &+ \rex.
%% \end{align}


Note that we could move the discretised values of the unknowns outside of the integrals because they are constant in space. However we prefer to evaluate values at points within the elements where possible (by integrating using Gaussian quadrature) since some quantities are discontinous at the nodes.\footnote{For example if the basis functions are linear then derivatives are discontinous at the nodes.}

Also note that we have $7N$ equations in $7N$ unknowns and each of the integrals in the equations can be evaluated only in terms of the shape/test functions, their derivatives, the outward unit normal vector and the Neumann boundary condition. Hence we have a system of algebraic equations which we can solve.

As described in \autoref{sub:Actual-Finite-Elements} we can convert this ``global'' representation into a number of ``local'' representations -- one on each element. We first split the domain into $N_e$ elements. We then define the basis functions such that they are only non-zero on elements in which they are contained (\ie we are using a finite element method). Then the global residuals can be split into the local contributions each element which are easy to calculate since they only depend on nodes within the element.\footnote{Unfortunately this property will be lost to some extent when we introduce the hybrid FEM/BEM in \autoref{sec:hybr-finit-elem}.}

Let $\magd_\eli$ represent the volume of element $e$, let $\boundd_\eli$ represent any part of the boundary of the element which is on $\boundd$ (nothing for most elements). Then the contribution of element $\eli$ to the residuals at node $\ndi$ is exactly as given above except that the integrations only need to be performed over $\magd_\eli$ and $\boundd_\eli$ rather than $\magd$ and $\boundd$. Also note that the sums only need to consider values of $k$ such that node $k$ is in element $\eli$ and that residual contributions only need to be calculated for nodes $\ndi$ such that node $\ndi$ is in element $\eli$.




\section{Jacobian calculation}
\label{ll-sec:ll-jacobian-calculation}

Similarly to calculations in \autoref{sec:llg-jacobian-calculation}.

First note that the part of the residual corresponding to the double-cross-product exchange field term ($\mv \times \mv \times \lap \mv$) is more complex and cannot be written in terms of skew operators (as far as I can tell).
We will calculate it separately later, but for now we write it as $\rexh$.

After replacing cross products with the skew operator and substituting in the interpolation formulae for $\mv$ we have
\begin{equation}
  \begin{aligned}
    \rll = \int_\magd \tbf &\Bigg[ \left( \sum_\ibasisc \sk \pd{\mv_\ibasisc}{t} \right)
      \\
      & + \crossop{\intp{\mv}}{\happ + \hms} + \crossop{\intp{\mv}}{\hca}
      \\
      &+ \dampc \crossop{\intp{\mv}}{\crossop{\intp{\mv}}{\happ + \hms}}
      \\
      &+ \dampc \crossop{\intp{\mv}}{\crossop{\intp{\mv}}{\hca}} \Bigg] \\
    &+ \skewm{\intp{\mv}} \cdot \nabla \mv \cdot \nabla \tbf \d\magd
    + \rexh.
  \end{aligned}
\end{equation}
Differentiating then pulling out a factor of $\sbf_l$ gives
\begin{equation}
  \begin{aligned}
    \pd{\rll}{\mv_l} =  \int_\magd \tbf \sbf_l &\Bigg[
      \Jmts
      \\
      &+ \skewm{\happ + \hms} + \skewm{\hca} + \frac{1}{\sbf_l} \skewm{\mv} \cdot \pd{\hca}{\mv_l}
      \\
      &+ \dampc \skewm{\crossop{\mv}{\happ + \hms}}
      + \dampc \skewm{\mv} \cdot \skewm{\happ + \hms}
      \\
      &+ \dampc \skewm{\crossop{\mv}{\hca}}
      + \dampc \crossop{\mv}{\skewm{\hca} + \frac{1}{\sbf_l}\crossop{\mv}{\pd{\hca}{\mv_l}}}
      \Bigg]
    \\
    &+ \sbf_l \skewm{\nabla \mv \cdot \nabla \tbf}
    + \skewm{\mv} \nabla \sbf_l \cdot \nabla \tbf \d\magd
    \\
    &+ \pd{\rexh}{\mv_l},
  \end{aligned}
\end{equation}
where we have replaced the interpolation formulae with $\mv$ where they still occur in the Jacobian.
By combining terms and rearranging a little we can simplify this to
\begin{equation}
  \begin{aligned}
    \pd{\rll}{\mv_l} =  \int_\magd \tbf \sbf_l &\Bigg[
      \Jmts
      + \skewm{\happ + \hms + \hca}
      \\
      &+ \dampc \skewm{ \crossop{\mv}{\happ + \hms + \hca}}
      + \dampc \skewm{\mv} \cdot \skewm{\happ + \hms + \hca}
      \Bigg]
    \\
    &+ (I_3 + \dampc \skewm{\mv}) \cdot \skewm{\mv} \cdot \pd{\hca}{\mv_l}
    \\
    &+ \sbf_l \skewm{\nabla \mv \cdot \nabla \tbf}
    + \skewm{\mv} \nabla \sbf_l \cdot \nabla \tbf \d\magd
    \\
    &+ \pd{\rexh}{\mv_l}.
  \end{aligned}
\end{equation}

??ds write the following out as 9 separate linear terms?

??ds explain where this is from a bit better, might need to rearrange the residual calc ending a bit

Now we deal with the other exchange term, which unfortunately cannot be written in terms of the skew operator. It is
\begin{equation}
  \begin{aligned}
    \left[\rexh \right]_i &= \dampc \int_\magd
    \left(\nabla \tbf \cdot \nabla m_i \right)
    - \sum_p \left[ m_p
      \left(\nabla(\tbf m_i) \cdot \nabla m_p \right)
      + \tbf m_i (\nabla m_p)^2 \right] \d\magd.
  \end{aligned}
\end{equation}
We use the fact that
\begin{equation}
  \pd{m_i}{m_{l,j}} = \delta_{ij} \sbf_l,
\end{equation}
which gives us
\begin{equation}
  \begin{aligned}
    \pd{[\rexh]_i}{m_{l,j}} &= \dampc \int_\magd
    \delta_{ij}\, \left(\nabla \tbf \cdot \nabla \sbf_l \right)
    \\
    &- \sum_p \Bigg[
       \delta_{pj}\, \sbf_l \left(\nabla(\tbf m_i) \cdot \nabla m_p \right)
       \\
       &+ \delta_{ij}\, m_p \left(\nabla(\tbf \sbf_l) \cdot \nabla m_p \right)
       + \delta_{pj}\, m_p \left(\nabla(\tbf m_i) \cdot \nabla \sbf_l \right)
       \\
       &+ \delta_{ij}\, \tbf \sbf_l (\nabla m_p)^2
       + 2 \delta_{pj}\, \tbf m_i (\nabla m_p \cdot \nabla \sbf_l)
      \Bigg]
    \d\magd.
  \end{aligned}
\end{equation}

We simplify this expression by using a property of the Kronecker delta
\begin{equation}
  \sum_p \delta_{pj} y_j = y_p,
\end{equation}
to pull some terms out of the summation, leaving
\begin{equation}
  \begin{aligned}
    \pd{[\rexh]_i}{m_{l,j}} &= \dampc \int_\magd
    \delta_{ij}\, \left(\nabla \tbf \cdot \nabla \sbf_l \right)
    \\
    &- \delta_{ij}\, \sum_p \Big[
      m_p \left(\nabla(\tbf \sbf_l) \cdot \nabla m_p \right)
      +\tbf \sbf_l (\nabla m_p)^2
      \Big]
    \\
    &- \sbf_l \left(\nabla(\tbf m_i) \cdot \nabla m_j \right)
    - m_j \left(\nabla(\tbf m_i) \cdot \nabla \sbf_l \right)
    - 2\tbf m_i (\nabla m_j \cdot \nabla \sbf_l).
  \end{aligned}
\end{equation}

Finally we can use the fact that (from the chain rule)
\begin{equation}
  \nabla(\tbf m_i) \cdot \nabla \left( \sbf_l m_j \right)
   = \sbf_l \left(\nabla(\tbf m_i) \cdot \nabla m_j \right)
    + m_j \left(\nabla(\tbf m_i) \cdot \nabla \sbf_l \right)
\end{equation}
to get
\begin{equation}
  \begin{aligned}
    \pd{[\rexh]_i}{m_{l,j}} &= \dampc \int_\magd
    \delta_{ij}\, \left(\nabla \tbf \cdot \nabla \sbf_l \right)
    \\
    &- \delta_{ij}\, \sum_p \Big[
      m_p \left(\nabla(\tbf \sbf_l) \cdot \nabla m_p \right)
      +\tbf \sbf_l (\nabla m_p)^2
      \Big]
    \\
    &- \nabla(\tbf m_i) \cdot \nabla \left( \sbf_l m_j \right)
    - 2 \tbf m_i (\nabla m_j \cdot \nabla \sbf_l) \d\magd.
  \end{aligned}
\end{equation}

%% ??ds TODO
%% \begin{itemize}
%% \item explain differentiating by vector, abuse of notation..
%% \item how related to blocked Jacobian
%% \end{itemize}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
