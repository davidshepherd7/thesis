
%% Define new commands
%% ============================================================

%% General Latex commands
%% ------------------------------
% New way to define commands that allows multiple subscripts
\makeatletter
\newcommand\newsubcommand[3]{\newcommand#1{#2\sc@sub{#3}}}
\def\sc@sub#1{\def\sc@thesub{#1}\@ifnextchar_{\sc@mergesubs}{_{\sc@thesub}}}
\def\sc@mergesubs_#1{_{\sc@thesub#1}}


% define a macro to allow multiple references to be passed to \autoref
\newcommand\autorefs[1]{\@first@ref#1,@}
\def\@throw@dot#1.#2@{#1}% discard everything after the dot
\def\@set@refname#1{%    % set \@refname to autoefname+s using \getrefbykeydefault
  \edef\@tmp{\getrefbykeydefault{#1}{anchor}{}}%
  \def\@refname{\@nameuse{\expandafter\@throw@dot\@tmp.@autorefname}s}%
}
\def\@first@ref#1,#2{%
  \ifx#2@\autoref{#1}\let\@nextref\@gobble% only one ref, revert to normal \autoref
  \else%
  \@set@refname{#1}%  set \@refname to autoref name
  \@refname~\ref{#1}% add autoefname and first reference
  \let\@nextref\@next@ref% push processing to \@next@ref
  \fi%
  \@nextref#2%
}
\def\@next@ref#1,#2{%
  \ifx#2@ and~\ref{#1}\let\@nextref\@gobble% at end: print and+\ref and stop
  \else, \ref{#1}% print  ,+\ref and continue
  \fi%
  \@nextref#2%
}

\makeatother

%% % The LyX greyedout annotation environment
%% \usepackage{color}
%% \definecolor{note_fontcolor}{rgb}{0.80078125, 0.80078125, 0.80078125}
%% \newenvironment{lyxgreyedout}
%% {\textcolor{note_fontcolor}\bgroup\ignorespaces}
%% {\ignorespacesafterend\egroup}

% Latin
% ============================================================

% trailing slash is needed so that latex knows the final . is not the end
% of a sentence.

\newcommand{\ie}{\textit{i.e.}\ }
\newcommand{\cf}{\textit{c.f.}\ }
\newcommand{\eg}{\textit{e.g.}\ }
\newcommand{\etal}{\textit{et al.}\ }
\newcommand{\etc}{etc.\ }



%% General maths commands
%% ------------------------------
\newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}} % partial deriv
\newcommand{\spd}[2]{\frac{\partial^2 #1}{\partial {#2}^2}} % 2nd partial deriv
\newcommand{\ddn}[1]{\pd{#1}{\nv}} % normal derivative
\newcommand{\vd}[2]{\frac{\delta #1}{\delta #2}} % variational derivative
\newcommand{\myvector}[1]{\mathbf{#1}}
\newcommand{\goesto}{\rightarrow}

\newcommand{\E}[1]{\times 10^{#1}} % powers of 10
\newcommand{\st}{\,|\,} % ``such that'' operator in sets (vertical line with spacing)

\newcommand{\ip}[2]{\left(#1,\, #2 \right)} % inner product
\newcommand{\ltip}[2]{\ip{#1}{#2}_{\ltwo}} % l2 inner product


% Norm and abs: better spacing than if done manually with |
\newcommand{\abs}[1]{\left|{#1} \right|}
\newcommand{\norm}[1]{\lVert #1 \rVert}
\newcommand{\ltnorm}[1]{\norm{#1}_{\ltwo}}

% rescaled time
\newcommand{\that}{\hat{t}}

% d for the end of integrals (e.g. dx) with correct spacing and non-italic
\renewcommand{\d}{{\; \text{d}}}
% standard integrals
\newcommand{\intd}[2][\magd]{{\int_{#1} #2 \d {#1}}}
\newcommand{\intb}[1]{\intd[\boundd]{#1}}

% Some vector functions
\newcommand{\gv}{{\myvector{g}}}
\newcommand{\fv}{{\myvector{f}}}
\newcommand{\pv}{{\myvector{p}}}


\newcommand{\ffv}[1]{{\myvector{f}\bigb{#1}}}
\newcommand{\gfv}[1]{{\myvector{g}\bigb{#1}}}


% Some vectors
\newcommand{\av}{{\myvector{a}}}
\newcommand{\bv}{{\myvector{b}}}
\newcommand{\cv}{{\myvector{c}}}
\newcommand{\sv}{{\myvector{s}}}
\newcommand{\kvec}{\myvector{k}}

\newcommand{\ev}{\myvector{\hat{e}}}
\newcommand{\nv}{\myvector{\hat{n}}}

\newcommand{\xv}{\myvector{x}}
\newcommand{\yv}{\myvector{y}}
\newcommand{\zv}{\myvector{z}}
\newcommand{\lv}{\myvector{l}}

\newcommand{\unitv}[1]{{\hat{\mathbf{#1}}}}
\newcommand{\iv}{\unitv{i}}
\newcommand{\jv}{\unitv{j}}
\newcommand{\kv}{\unitv{k}}
\newcommand{\unitz}{\unitv{z}}

% Matrices
\newcommand{\mymatrix}[1]{\mathrm{#1}}
\newcommand{\Pm}{\mymatrix{P}}
\newcommand{\Qm}{\mymatrix{Q}}
\newcommand{\Idm}{\mymatrix{I}}
\newcommand{\Am}{\mymatrix{A}}
\newcommand{\Gm}{\mymatrix{G}}
\newcommand{\Fm}{\mymatrix{F}}
\newcommand{\Mm}{\mymatrix{M}}
\newcommand{\Jm}{\mymatrix{J}}
\newcommand{\Km}{\mymatrix{K}}
\newcommand{\Jmca}{\mymatrix{J}_\text{ca}}
\newcommand{\Jmts}{\mymatrix{J}_\text{ts}}
\newcommand{\jts}{j_\text{ts}}

% Brackets
\newcommand{\bigb}[1]{{\left( #1 \right)}}
\newcommand{\bigs}[1]{{\left[ #1 \right]}}
\newcommand{\evalat}[1]{{\left|_{#1}\right.}}

% BEM
\newcommand{\bm}{{\mathbf{\Gm}}}
\newcommand{\tri}{\vartriangle}



% 3-component vector as a list of components
\newcommand{\threevec}[3]{\begin{pmatrix} #1 \\ #2 \\ #3 \end{pmatrix} }
\newcommand{\threevecdup}[1]{\threevec{#1}{#1}{#1}}


% Big O notation
\newcommand{\order}[1]{\text{O}(#1)}
\newcommand{\porder}[1]{\quad + \order{#1}} % with larger spacing

% Differential operators
\renewcommand{\div}{\nabla \cdot} % \div is normally division
\newcommand{\grad}{\nabla}
\newcommand{\curl}{\nabla \cross}
\newcommand{\lap}{\nabla^2}

\newcommand{\compdot}{\mathbin{:}}



%% Spaces, domains and geometrical labels
%% ------------------------------
% Domain labels used
\newcommand{\magd}{\Omega}
\newcommand{\boundd}{{\Gamma}}
\newcommand{\fulld}{{\real^d}}
\newcommand{\extd}{{\Omega^c}}

% Interior/exterior labels
\newcommand{\inte}{\text{int}}
\newcommand{\exte}{\text{ext}}

\newcommand{\real}{\mathbb{R}} % real numbers
\newcommand{\complex}{\mathbb{C}} % complex numbers
\newcommand{\integers}{\mathbb{Z}} % integer numbers

\newcommand{\sob}{\mathcal{H}} % Sobelov spaces
\newcommand{\ltwo}{L^2} %L2

\newcommand{\Dfs}{\mathcal{D}} % Set of functions that obey Dirichlet boundaries
\newcommand{\Neu}{{\scriptscriptstyle{\mathcal{N}}}} % Neumann


%% Magnetics
%% ------------------------------
% Define M, H, B vectors (i.e. bold)
\newcommand{\Mv}{\myvector{M}}
\newcommand{\Hv}{\myvector{H}}
\newcommand{\Bv}{\myvector{B}}


% polar coords
\newcommand{\ruv}{\myvector{\hat{r}}} % r unit vector
\newcommand{\phiv}{\myvector{\hat{\phi}}}
\newcommand{\thetav}{\myvector{\hat{\theta}}}
\newcommand{\rv}{\myvector{r}} % r vector


% Define some common types of H-field.
% if changing these beware of components of H which are not defined here.
\newsubcommand{\Heff}{\myvector{H}}{{\text{eff}}} %effective (total)
\newsubcommand{\Happ}{\myvector{H}}{{\text{ap}}} %applied
\newsubcommand{\Hms}{\myvector{H}}{\text{ms}} % magnetostatic/demag
\newsubcommand{\Hex}{\myvector{H}}{\text{ex}} % exchange
\newsubcommand{\Hca}{\myvector{H}}{\text{ca}} % crystalline ansiotropy
\newsubcommand{\Hthm}{\myvector{H}}{\text{th}} % thermal

\newcommand{\phim}{\phi} % magnetostatic potential
\newcommand{\phione}{u} % auxilary potential
\newcommand{\phitwo}{v} % other auxilary potential

% Normalised versions of the above fields (and M)
\newcommand{\mv}{\myvector{m}}
\newcommand{\hv}{\myvector{h}}
\newsubcommand{\heff}{\myvector{h}}{{\text{eff}}} %effective (total)
\newsubcommand{\happ}{\myvector{h}}{{\text{ap}}} %applied
\newsubcommand{\hms}{\myvector{h}}{\text{ms}} % magnetostatic/demag
\newsubcommand{\hex}{\myvector{h}}{\text{ex}} % exchange
\newsubcommand{\hca}{\myvector{h}}{\text{ca}} % crystalline ansiotropy
\newsubcommand{\hthm}{\myvector{h}}{\text{th}} % thermal
\newcommand{\nH}{H_{\mathbb{n}}} % A "magnitude" of H for normalisation

% Similarly for energies
\newsubcommand{\Eapp}{E}{{\text{ap}}} %applied
\newsubcommand{\Ems}{E}{\text{ms}} % magnetostatic/demag
\newsubcommand{\Eex}{E}{\text{ex}} % exchange
\newsubcommand{\Eca}{E}{\text{ca}} % crystalline ansiotropy
\newcommand{\e}{e} % total energy
\newsubcommand{\eapp}{e}{{\text{ap}}} %applied
\newsubcommand{\ems}{e}{\text{ms}} % magnetostatic/demag
\newsubcommand{\eex}{e}{\text{ex}} % exchange
\newsubcommand{\eca}{e}{\text{ca}} % crystalline ansiotropy
\newsubcommand{\ehop}{\e}{\hop} % total due to h operator fields


\newcommand{\nE}{E_{\mathbb{n}}} % A "magnitude" of energy for normalisation
\newcommand{\nA}{\mathbb{A}} % A "magnitude" of exchange const for normalisation
\newcommand{\nK}{\mathbb{K}} % A "magnitude" of anisotropy const for normalisation

% Magnetic constants
\newcommand{\Exchc}{A}
\newcommand{\Kone}{K_1}
\newcommand{\kone}{\mathcal{K}_1}
\newcommand{\dampc}{\alpha}
\newcommand{\dampeff}{\alpha_\text{eff}}
\newcommand{\gymagc}{{\abs{\gamma_{\text{\tiny{L}}}}}}


% SI magnetic units (Kronmuller2003)
\newcommand{\Mu}{{\text{Am}^{-1}}}
\newcommand{\Hu}{{\text{Am}^{-1}}}
\newcommand{\phiu}{{\text{A}}} % magnetic potentials
\newcommand{\Bu}{{\text{T}}}
\newcommand{\gymagu}{{\text{A}(\text{ms})^{-1}}}

% Define the LLG equation (in parts then all together)
\newcommand{\dMdt}{\pd{\Mv}{t}} % define dM/dt
\newcommand{\dmdt}{\pd{\mv}{t}}
\newcommand{\dMdn}{\pd{\Mv}{\nv}}
\newcommand{\dmdn}{\pd{\mv}{\nv}}

\newcommand{\MxH}{\Mv \times \Hv} % define M x H
\newcommand{\mxh}{\mv \times \hv}
\newcommand{\mxmxh}{\mv \left(\mv \times \hv \right)}
\newcommand{\MxdMdt}{\Mv \times \dMdt}
\newcommand{\mxdmdt}{\mv \times \dmdt}
\newcommand{\llg}{\dmdt = -(\mxh) + \dampc (\mxdmdt)}

%% Finite elements/numerical models
%% ------------------------------
% Define the test and shape functions
\newcommand{\tbf}{\varphi}
\newcommand{\tbfv}{\myvector{\varphi}}
\newcommand{\test}{v}
\newcommand{\testv}{\myvector{\test}}

\newcommand{\sbf}{\psi}
\newcommand{\ts}{{\mathcal{H}^1_h(\magd)}} % my test/shape fn space
\newcommand{\sk}{{\sbf_k}}
\newcommand{\tn}{{\tbf_\ndi}}

% Indices
\newcommand{\ndi}{n} % nodal index, not sure what to have it as...
\newcommand{\eli}{e} % element index
\newcommand{\tl}{l} % time-step index

% Green's functions - general form and main parts of 2/3D Green's functions for the laplacian operator
\newcommand{\Green}[1][]{G(\xv_{#1},\yv)}
\newcommand{\Gtwod}[1][]{\ln \abs{\xv_{#1} - \yv}}
\newcommand{\Gthreed}[1][]{\frac{1}{ \abs{\xv_{#1} - \yv}}}

% subscripts used
\newcommand{\ibasis}{{i}}
\newcommand{\ibasisb}{{j}}
\newcommand{\ibasisc}{{k}}

%% Time stepping
%% ------------------------------

% time step
\newcommand{\dtn}{\dtx{n}}
\newcommand{\dtx}[1]{\Delta_{#1}}

% "value step"
% Getting bold greek requires a hack because mathbf sees it as a "symbol"
% and so doesn't change it. This uses the direct TeX solution (from google!)
\newcommand{\dyn}{\dyx{n}}
\newcommand{\dyx}[1]{\mbox{\boldmath$\delta$}_{#1}}

% Denote various time steppers
\newcommand{\AB}{\text{AB}} % Adams-Bashforth 2
\newcommand{\imr}{\text{IMR}} % Implicit midpoint
\newcommand{\tr}{\text{TR}}
\newcommand{\bdf}{\text{BDF2}}
\newcommand{\FE}{\text{FE}} % Forward Euler (like)
\newcommand{\ebdf}{\text{eBDF3}}

% Local truncation errors
\newcommand{\lte}{T_n}

% Tol
\newcommand{\toltt}{\epsilon_{\dtx{}}}

% Newton's method
% ============================================================

% tol
\newcommand{\newtontol}{\epsilon_{\text{N}}}


% Operators
% ============================================================
\usepackage{mathrsfs}
\newcommand{\myop}[1]{\mathscr{#1}}
\newcommand{\hop}{\myop{H}}
\newcommand{\hmsop}{\myop{H}_{\text{ms}}}
\newcommand{\aop}{\myop{A}}
\newcommand{\bop}{\myop{B}}
\newcommand{\cop}{\myop{C}}
\newcommand{\lop}{\myop{L}}
\DeclareMathOperator{\realp}{real}

% Fractions
% ============================================================

%% Nice one line fractions
\usepackage{xfrac}
\usepackage[ugly]{nicefrac}

\newcommand{\half}{\nicefrac{1}{2}}


% Some typewritter text
% ============================================================

% Make sure it's not italic or anything as well as being tt, because it
% looks different (and stupid). \xspace makes sure there is a space
% afterwards at the correct times without having to explicitly write the
% empty argument (i.e. \toltt{}). It can be suppressed by writing the empty
% argument.
% \newcommand{\toltt}{{\textrm{\textup{\texttt{tol}}}\xspace}}
%% Didn't want this anyway in the end


% Stuff needed for galerkin
% ============================================================
\newcommand{\skewop}{\text{\Large{$\Lambda$}}}
\newcommand{\skewm}[1]{\skewop\left[ #1 \right]}
\newcommand{\crossop}[2]{\skewm{ #1 } \cdot \left( #2 \right)}

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
    \node[shape=circle,draw,inner sep=1pt] (char) {#1};}}
\newcommand{\mxex}{I}
\newcommand{\mxmxex}{J}

\newcommand{\intp}[1]{\sum_\ibasisc \sk #1_\ibasisc}
\newcommand{\intpb}[1]{\left( \intp{#1} \right)}
\newsubcommand{\hs}{\hv}{\text{s}}

\newcommand{\ik}{\ibasisc}

% residuals
\newsubcommand{\rex}{\myvector{r}}{\text{ex}}
\newsubcommand{\rexh}{\myvector{r}}{\text{ex,h}}
\newsubcommand{\rll}{\myvector{r}}{\text{ll}}
\newcommand{\rllg}{\rv}
\newcommand{\rphi}{s}



% Notation for midpoint method stuff
% ============================================================

% t at midpoint
\newcommand{\thfx}[1]{t_{#1+\half}}
\newcommand{\thf}{\thfx{n}}

% exact y of t at midpoint
\newcommand{\yvhfx}[2]{\yv#1(\thfx{#2})}
\newcommand{\yvhf}[1][]{\yvhfx{#1}{n}}

% midpoint approximation to y
\newcommand{\yvmx}[1]{\yv_{#1+\half}}
\newcommand{\yvm}{\yvmx{n}}


% df/dy matrix
\newcommand{\dfdy}{F}
\newcommand{\dfdyhfx}[1]{\dfdy_{#1+\half}}
\newcommand{\dfdyhf}{\dfdyhfx{n}}

% error due to midpoint approx
\newcommand{\ymiderr}{a_n}

% full expressions for midpoint values
\newcommand{\mpm}{\frac{\mv_{n+1} + \mv_n}{2}}
\newcommand{\mpt}{\frac{t_n + t_{n+1}}{2}}
\newcommand{\mpdmdt}{\frac{\mv_{n+1} - \mv_n}{\dtn}}
\newcommand{\mphop}{\hop \left[ \mpm \right]}
\newcommand{\mphapp}{\happ \left(\mpt \right)}


% Commands from intermag paper 
% ============================================================

\newcommand{\dash}{\text{-}}
\newcommand{\dtinitial}{\dtx{\text{init}}}
\newcommand{\dtmax}{\dtx{\text{max}}}
\newcommand{\zerov}{\mathbf{0}}
\newcommand{\mvtemp}{\tilde{\mv}}


% Paper/thesis commands
% ============================================================

\ifthesis
\newcommand{\secpaper}{Section}
\else
\newcommand{\secpaper}{paper}
\fi


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
